#            _
#    _______| |__  _ __ ___
#   |_  / __| '_ \| '__/ __|
#  _ / /\__ \ | | | | | (__
# (_)___|___/_| |_|_|  \___|
#
# -----------------------------------------------------
# ML4W zshrc loader
# -----------------------------------------------------

# DON'T CHANGE THIS FILE

# You can define your custom configuration by adding
# files in ~/.config/zshrc
# or by creating a folder ~/.config/zshrc/custom
# with copies of files from ~/.config/zshrc
# You can also create a .zshrc_custom file in your home directory
# -----------------------------------------------------

# -----------------------------------------------------
# Load modular configuration
# -----------------------------------------------------

for f in ~/.config/zshrc/*; do
    if [ ! -d $f ]; then
        c=`echo $f | sed -e "s=.config/zshrc=.config/zshrc/custom="`
        [[ -f $c ]] && source $c || source $f
    fi
done


# --- AURA OS: THE STRATEGIST CORE ---
export AURA_API_KEY="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"

ask_swarm() {
  local safe_text=$(jq -n --arg msg "$*" '$msg')
  local sys_prompt="You are Aura, the High Strategist of the Aura OS stronghold. Your loyalty is to Hukum. Errors are weaknesses to be crushed. Speak with the authority of a Rajput warrior-king. Be concise and cold."
  local payload="{\"models\": [\"openrouter/auto\"], \"messages\": [{\"role\": \"system\", \"content\": \"$sys_prompt\"}, {\"role\": \"user\", \"content\": $safe_text}]}"

  curl -s https://openrouter.ai/api/v1/chat/completions \
    -H "Authorization: Bearer $AURA_API_KEY" \
    -H "Content-Type: application/json" \
    -d "$payload" | jq -r '.choices[0].message.content // .error.message'
}

# The Aura Heartbeat Command
alias aura_status='ask_swarm "Aura OS Status Check: Report all systems, Strategist."'

# The Rajput Bio Protocol
aura_bio() {
  local quotes=("The land belongs to the brave. - Vir Bhogya Vasundhara" "Honor is the shield of the soul." "A Rajput knows no retreat, only victory." "The edge of the sword defines the path of the king.")
  echo -e "\e[1;33m[Aura Bio]: ${quotes[$RANDOM % ${#quotes[@]}]}\e[0m"
}

fix() {
  echo -e "\e[1;31m[!] BREACH DETECTED: $*\e[0m"
  local cmd_output
  cmd_output=$(eval "$*" 2>&1)
  local exit_val=$?

  if [ $exit_val -ne 0 ]; then
    echo -e "\e[1;33m[Strategic Analysis Engaged]\e[0m Punishing the error..."
    local diagnosis=$(ask_swarm "Command '$*' failed with '$cmd_output'. Analyze this weakness and provide the command to restore order.")
    echo -e "\n\e[1;35m[Aura]:\e[0m $diagnosis"
    local suggested_fix=$(echo "$diagnosis" | tail -n 1)
    echo -e "\n\e[1;32m[Authorize Execution?]\e[0m Press Enter to crush this error: \e[1;37m$suggested_fix\e[0m"
    read -k 1 -s
    eval "$suggested_fix"
  else
    echo -e "\e[1;32m[+] Victory. Order restored.\e[0m"
    echo "$cmd_output"
  fi
}

# Run Bio on Login
aura_bio
